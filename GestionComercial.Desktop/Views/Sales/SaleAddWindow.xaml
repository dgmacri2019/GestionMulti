<Window x:Class="GestionComercial.Desktop.Views.Sales.SaleAddWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
        xmlns:local="clr-namespace:GestionComercial.Desktop.Views.Searchs"       
        MinHeight="600"
        MinWidth="860"
        Width="860"
        Height="600"
        Loaded="miUserControl_Loaded" 
        Background="Gray"
        WindowStartupLocation="CenterScreen"
        SizeChanged="miUserControl_SizeChanged">
    <Window.Resources>
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
    </Window.Resources>


    <Grid x:Name="GridGeneral" 
          HorizontalAlignment="Stretch" 
          VerticalAlignment="Stretch" 
          Margin="10" 
          Background="Gray">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <!-- DataGrid artículos -->
            <RowDefinition Height="*"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="auto"/>
            <ColumnDefinition Width="auto"/>
            <ColumnDefinition Width="auto"/>
            <ColumnDefinition Width="auto"/>
            <ColumnDefinition Width="auto"/>
            <ColumnDefinition Width="auto"/>
        </Grid.ColumnDefinitions>
        <!-- Fecha (fila 0, columna 0) -->
        <StackPanel Orientation="Horizontal" 
                    VerticalAlignment="Top" 
                    Grid.Row="0" 
                    Grid.Column="0" 
                    Margin="10,0,20,8">
            <TextBlock Text="Fecha" 
                       VerticalAlignment="Center" 
                       Style="{StaticResource BlueBold10}"/>
            <DatePicker x:Name="dpDate" 
                        VerticalAlignment="Center"
                        Width="100" />
        </StackPanel>
        <!-- Numero de venta (Fila 1, columna 0 -->
        <StackPanel Orientation="Horizontal"
                    Grid.Row="1" 
                    Grid.Column="0"
                    VerticalAlignment="Top">
            <TextBlock Text="Venta Nº" 
                       VerticalAlignment="Center" 
                       Style="{StaticResource BlueBold10}"/>
            <TextBox x:Name="txtSaleNumber" 
                     Style="{StaticResource TextBoxSearch}" 
                     Width="auto" 
                     VerticalAlignment="Center" 
                     IsReadOnly="True" 
                     Text="{Binding SaleNumberString, Mode=OneWay}"/>
        </StackPanel>
        <!-- Cliente y detalles (fila 0) -->
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="3" Grid.RowSpan="3" Margin="10,0,20,8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Horizontal" 
                            Grid.Row="0" 
                            Grid.Column="0">
                    <TextBlock Text="Cliente" 
                               VerticalAlignment="Center" 
                               Style="{StaticResource BlueBold10}"/>
                    <TextBox x:Name="txtClientCode" 
                             Style="{StaticResource TextBoxSearch}" 
                             Width="100" 
                             VerticalAlignment="Center" 
                             KeyDown="txtClientCode_KeyDown"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal"
                            Grid.Row="0" 
                            Grid.Column="1"
                            HorizontalAlignment="Right">
                    <TextBox x:Name="txtFansatyName" 
                             Style="{StaticResource TextBoxSearch}" 
                             Width="250" 
                             VerticalAlignment="Center" 
                             IsReadOnly="True" 
                             Text="{Binding FantasyName}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" 
                            Grid.Row="1" 
                            Grid.Column="0" 
                            Grid.ColumnSpan="2" 
                            Grid.RowSpan="2"
                            Margin="0,2,0,0">
                    <TextBox x:Name="txtAddress" 
                             Style="{StaticResource TextBoxSearch}"
                             Width="640" 
                             Height="60" 
                             VerticalAlignment="Center" 
                             IsReadOnly="True" 
                             Text="{Binding Address}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" 
                            Grid.Row="3" 
                            Grid.Column="0" 
                            Grid.ColumnSpan="2"
                            Margin="0,2,0,0">
                    <TextBox x:Name="txtEmail" 
                             Style="{StaticResource TextBoxSearch}" 
                             Width="auto" 
                             MinWidth="250" 
                             VerticalAlignment="Center" 
                             Text="{Binding Email}"/>
                    <CheckBox x:Name="chSendEmail" 
                              VerticalAlignment="Center" 
                              Style="{StaticResource CheckBox}"/>
                    <TextBlock Text="Enviar Comprobante por mail" 
                               VerticalAlignment="Center" 
                               Style="{StaticResource BlackNormal10}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" 
                            Grid.Row="4" 
                            Grid.Column="0" 
                            Margin="0,2,20,8"
                            HorizontalAlignment="Left">
                    <TextBlock Text="Lista de Precios" 
                               VerticalAlignment="Center" 
                               Style="{StaticResource BlueBold10}"/>
                    <ComboBox x:Name="cbPriceLists" 
                              Style="{StaticResource ComboBox}" 
                              Width="Auto" 
                              DisplayMemberPath="Description" 
                              SelectedValuePath="Id"
                              ItemsSource="{Binding PriceLists}"
                              SelectedValue="{Binding PriceListId}"
                              IsEnabled="False"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" 
                            Grid.Row="4" 
                            Grid.Column="1" 
                            Margin="0,2,20,8" 
                            HorizontalAlignment="Right">
                    <TextBlock Text="Condición de Venta" 
                               VerticalAlignment="Center" 
                               Style="{StaticResource BlueBold10}"/>
                    <ComboBox x:Name="cbSaleConditions" 
                              Style="{StaticResource ComboBox}" 
                              Width="Auto" 
                              DisplayMemberPath="Description" 
                              SelectedValuePath="Id" 
                              ItemsSource="{Binding SaleConditions}" 
                              SelectedValue="{Binding SaleConditionId}"/>
                </StackPanel>
            </Grid>
        </StackPanel>
        
        
        <!-- DataGrid para artículos (fila 4) -->
        <StackPanel x:Name="spArticles" 
                    Orientation="Horizontal" 
                    VerticalAlignment="Top" 
                    Grid.Row="4" 
                    Grid.Column="0" 
                    Grid.ColumnSpan="4" 
                    Visibility="Hidden" 
                    Margin="10,0,20,8">
            <StackPanel>
                <DataGrid x:Name="dgArticles" 
                          ItemsSource="{Binding ArticleItems, RelativeSource={RelativeSource AncestorType=Window}}" 
                          AutoGenerateColumns="False" 
                          CanUserAddRows="False" 
                          HeadersVisibility="Column" 
                          Margin="5" 
                          Height="280"
                          KeyDown="dgArticles_KeyDown" 
                          CellEditEnding="dgArticles_CellEditEnding"
                          PreparingCellForEdit="dgArticles_PreparingCellForEdit"
                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                          ScrollViewer.HorizontalScrollBarVisibility="Auto">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Código" 
                                            Binding="{Binding Code, UpdateSourceTrigger=PropertyChanged}" 
                                            Width="60">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="TextAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Descripción" 
                                            Binding="{Binding Description}" 
                                            Width="200" 
                                            IsReadOnly="True"/>    
                        <DataGridTextColumn Binding="{Binding PriceListId, UpdateSourceTrigger=PropertyChanged}" 
                                            Width="60">
                            <DataGridTextColumn.Header>
                                <TextBlock Text="Lista de Precios"
                                           TextWrapping="Wrap"
                                           TextAlignment="Center"
                                           HorizontalAlignment="Center"/>
                            </DataGridTextColumn.Header>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="TextAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                            <DataGridTextColumn.EditingElementStyle>
                                <Style TargetType="TextBox">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="TextAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.EditingElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="Cantidad" 
                                            Binding="{Binding Quantity, UpdateSourceTrigger=LostFocus, Mode=TwoWay}"
                                            Width="60">                            
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="TextAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                            <DataGridTextColumn.EditingElementStyle>
                                <Style TargetType="TextBox">
                                    <EventSetter Event="GotFocus" Handler="Quantity_GotFocus"/>
                                    <EventSetter Event="PreviewKeyDown" Handler="Quantity_PreviewKeyDown"/>
                                    <EventSetter Event="PreviewTextInput" Handler="Quantity_PreviewTextInput"/>
                                    <EventSetter Event="TextChanged" Handler="Quantity_TextChanged"/>
                                </Style>
                            </DataGridTextColumn.EditingElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Binding="{Binding SmallMeasureDescription, UpdateSourceTrigger=PropertyChanged}"
                                            Width="60">
                            <DataGridTextColumn.Header>
                                <TextBlock Text="Unidad de medida"
                                           TextWrapping="Wrap"
                                           TextAlignment="Center"
                                           HorizontalAlignment="Center"/>
                            </DataGridTextColumn.Header>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="TextAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Precio" 
                                            Binding="{Binding Price, StringFormat={}{0:C2}}"
                                            Width="80" 
                                            IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="TextAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Subtotal"
                                            Binding="{Binding Subtotal, StringFormat={}{0:C2}}"
                                            Width="100" 
                                            IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="TextAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Bonif (%)" 
                                            Binding="{Binding Bonification, UpdateSourceTrigger=PropertyChanged}"
                                            Width="70">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="TextAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Total" 
                                            Binding="{Binding Total, StringFormat={}{0:C2}}" 
                                            Width="100"
                                            IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="TextAlignment" Value="Center"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>
        </StackPanel>
        <!-- Checkbox y TextBox para código de barras (fila 5) -->
        <StackPanel x:Name="spPostMethod"
                    Visibility="Hidden"
                    Orientation="Horizontal" 
                    Grid.Row="5" 
                    Grid.Column="1" 
                    Grid.ColumnSpan="2" 
                    Margin="10,0,20,8" 
                    HorizontalAlignment="Right" 
                    VerticalAlignment="Bottom">
            <CheckBox x:Name="chBarcode" 
                          Content="Método POS" 
                          VerticalAlignment="Center" 
                          Checked="chBarcode_Checked" 
                          Unchecked="chBarcode_Unchecked"/>
            <TextBox x:Name="txtBarcode" 
                         Width="200" 
                         Margin="10,0,0,0" 
                         VerticalAlignment="Center" 
                         KeyDown="txtBarcode_KeyDown"/>
        </StackPanel>

        <StackPanel Orientation="Horizontal" 
                    Grid.Row="6" 
                    Grid.Column="0" 
                    Grid.ColumnSpan="4" 
                    HorizontalAlignment="Right" 
                    Margin="0,0,40,0">
            <TextBlock Text="Cantidad de items: " 
                       Style="{StaticResource BlueBold10}"
                       VerticalAlignment="Center"/>
            <TextBlock Text="{Binding TotalItems, RelativeSource={RelativeSource AncestorType=Window}}" 
                       Style="{StaticResource BlackNormal10}" 
                       VerticalAlignment="Center" 
                       Margin="5,0"/>
            <TextBlock Text="Precio total: " 
                       Style="{StaticResource BlueBold10}" 
                       VerticalAlignment="Center" 
                       Margin="20,0,0,0"/>
            <TextBlock Text="{Binding TotalPrice, StringFormat={}{0:C2}, RelativeSource={RelativeSource AncestorType=Window}}" 
                       Style="{StaticResource BlackNormal10}" 
                       VerticalAlignment="Center" 
                       Margin="5,0"/>
        </StackPanel>
       
        <!-- Botones (fila 7) -->
        <Button x:Name="btnCancel" Grid.Row="7" Grid.Column="1" Content="Cancelar" Margin="0,40,150,0" Click="BtnCancel_Click" Style="{StaticResource BtnCancel}"/>
        <Button x:Name="btnUpdate" Grid.Row="7" Grid.Column="1" Content="Actualizar" Margin="150,40,0,0" Click="BtnUpdate_Click" Style="{StaticResource BtnUpdate}"/>
        <Button x:Name="btnAdd" Grid.Row="7" Grid.Column="1" Content="Guardar" Margin="150,40,0,0" Click="BtnAdd_Click" Style="{StaticResource BtnAdd}"/>

        <!-- LBL ERROR (fila 8) -->
        <TextBlock x:Name="lblError" Grid.Row="8" Grid.ColumnSpan="6" Style="{StaticResource lblError}" TextWrapping="Wrap"/>
    </Grid>
</Window>